<!DOCTYPE html>












  


<html class="theme-next pisces use-motion" lang="">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.1.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.1.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.1.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.1.0',
    sidebar: {"position":"left","display":"always","offset":12,"onmobile":false,"dimmer":false},
    back2top: true,
    back2top_sidebar: false,
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="Meteorix&#39;s Blog">
<meta property="og:url" content="https://meteorix.github.io/index.html">
<meta property="og:site_name" content="Meteorix&#39;s Blog">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Meteorix&#39;s Blog">





  
  
  <link rel="canonical" href="https://meteorix.github.io/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Meteorix's Blog</title>
  




  <script async src="//www.googletagmanager.com/gtag/js?id=UA-138766747-1"></script>
  <script>
    var host = window.location.hostname;
    if (host !== "localhost" || !true) {
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'UA-138766747-1');
    }
  </script>









  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Meteorix's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://meteorix.github.io/2019/09/29/python-ml-optimize/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="meteorix">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/qiyu.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Meteorix's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/09/29/python-ml-optimize/" class="post-title-link" itemprop="url">Python机器学习性能优化——PyCon2019分享</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-09-29 17:38:12 / Modified: 17:43:23" itemprop="dateCreated datePublished" datetime="2019-09-29T17:38:12+08:00">2019-09-29</time>
            

            
              

              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>文章放在了新开的个人技术公众号<code>Meteorix</code>，欢迎关注</p>
<p><img src="/images/qrcode.bmp" alt="qrcode.bmp"></p>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzU3ODg1NDg0OQ==&amp;mid=2247483733&amp;idx=1&amp;sn=50e64f16319411573ee5625a5eb3feb0&amp;chksm=fd6e4bfbca19c2ed17998fb72776028bfd250715897774c825355c8014da079fd10bf7f32df3&amp;token=1449769781&amp;lang=zh_CN#rd" target="_blank" rel="noopener">Python机器学习性能优化——PyCon2019分享</a></p>

          
        
      
    </div>

    
      


    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://meteorix.github.io/2019/09/07/bert-runtime/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="meteorix">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/qiyu.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Meteorix's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/09/07/bert-runtime/" class="post-title-link" itemprop="url">BERT Runtime</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-09-07 15:03:33 / Modified: 19:52:42" itemprop="dateCreated datePublished" datetime="2019-09-07T15:03:33+08:00">2019-09-07</time>
            

            
              

              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="BERT-Runtime"><a href="#BERT-Runtime" class="headerlink" title="BERT Runtime"></a>BERT Runtime</h1><p>最近继续怼<a href="https://arxiv.org/abs/1810.04805" target="_blank" rel="noopener">BERT</a>，项目大部分模型都上了BERT，真香啊。</p>
<p>本来一直在使用<code>PyTorch JIT</code>来解决加速和部署的问题，顺手还写了个<a href="https://github.com/ShannonAI/service-streamer" target="_blank" rel="noopener">service-streamer</a>来做web和模型的中间件。<br>正好上个月NVIDIA开源了基于<code>TensorRT</code>的<a href="https://github.com/NVIDIA/TensorRT/tree/release/5.1/demo/BERT" target="_blank" rel="noopener">BERT代码</a>，官方<a href="https://devblogs.nvidia.com/nlu-with-tensorrt-bert/" target="_blank" rel="noopener">blog</a>号称单次<code>inference</code>只用2.2ms，比cpu快20倍。但是正确的问法是：这东西能比TF/PyTorch快多少呢？</p>
<p>于是从<a href="https://developer.nvidia.com/tensorrt" target="_blank" rel="noopener">TensorRT</a>开始，认真学习了一波NVIDIA的BERT实现。并做了性能Benchmark对比TensorFlow和PyTorch，结论是gpu时间能快<strong>15%-30%</strong>。主要归因于对BERT的计算图优化，自己实现了4个cuda kernel，另外避免了TensorFlow和PyTorch等框架带来的overhead。</p>
<h2 id="Prerequisite"><a href="#Prerequisite" class="headerlink" title="Prerequisite"></a>Prerequisite</h2><p>比较有用的几个背景知识：</p>
<ol>
<li>当然是BERT的<a href="https://arxiv.org/abs/1810.04805" target="_blank" rel="noopener">Paper</a>，<a href="https://github.com/google-research/bert" target="_blank" rel="noopener">Tensorflow实现</a>，<a href="https://github.com/huggingface/pytorch-transformers" target="_blank" rel="noopener">PyTorch实现</a></li>
<li>Harvard写的著名解读<a href="http://nlp.seas.harvard.edu/2018/04/03/attention.html" target="_blank" rel="noopener">The Annotated Transformer</a></li>
<li>GPU和Cuda基础知识，很简单可以参考我的<a href="https://github.com/Meteorix/meteorix-blog/blob/master/_posts/cuda101.md" target="_blank" rel="noopener">cuda101</a></li>
</ol>
<h2 id="TensorRT"><a href="#TensorRT" class="headerlink" title="TensorRT"></a>TensorRT</h2><p><strong>TensorRT</strong>是NVIDIA官方推出的inference引擎，建立在CUDA之上。可以对<code>TensorFlow/PyTorch</code>等框架训练出来的模型进行CUDA优化，达到更高的inference性能。同时支持低精度参数、跨平台部署等，总之就是对自己家的GPU使用的最好。</p>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2019/09/07/bert-runtime/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </div>

    
      


    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://meteorix.github.io/2019/08/02/cuda101/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="meteorix">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/qiyu.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Meteorix's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/08/02/cuda101/" class="post-title-link" itemprop="url">cuda 101</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-08-02 11:58:11" itemprop="dateCreated datePublished" datetime="2019-08-02T11:58:11+08:00">2019-08-02</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-09-17 22:55:57" itemprop="dateModified" datetime="2019-09-17T22:55:57+08:00">2019-09-17</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="cuda-101"><a href="#cuda-101" class="headerlink" title="cuda 101"></a>cuda 101</h1><p>最近开始做深度学习后端和性能优化，做到模型部分需要补补gpu和cuda知识。记录此篇入门笔记，配合官方文档食用。</p>
<p>NVIDIA的官方文档和blog写的真好，读了一天非常舒服。很多之前调包（Pytorch/Tensorflow)不理解的地方，都有更深的认识，期待尽早开始写自己的kernel。</p>
<h2 id="get-started"><a href="#get-started" class="headerlink" title="get started"></a>get started</h2><p>从这篇官方博客开始quickstart，写的非常好，可以快速了解gpu特性、编程模型、显存等</p>
<p><a href="https://devblogs.nvidia.com/even-easier-introduction-cuda/" target="_blank" rel="noopener">https://devblogs.nvidia.com/even-easier-introduction-cuda/</a></p>
<h2 id="线程结构"><a href="#线程结构" class="headerlink" title="线程结构"></a>线程结构</h2><p><img src="/images/cuda101/grid.jpg" alt="image"></p>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2019/08/02/cuda101/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </div>

    
      


    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://meteorix.github.io/2019/06/07/netease-games/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="meteorix">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/qiyu.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Meteorix's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/06/07/netease-games/" class="post-title-link" itemprop="url">6年后，为什么离开网易游戏</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-06-07 01:11:12 / Modified: 01:29:36" itemprop="dateCreated datePublished" datetime="2019-06-07T01:11:12+08:00">2019-06-07</time>
            

            
              

              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>在网易游戏待了六年，如果说这里是一所大学，那我也算毕业了，能拿个优秀毕业生吗:-D</p>
<blockquote>
<p>游戏改变世界</p>
</blockquote>
<p>小s面试时问我梦想是什么，我想了很久说出这个答案。虽然听起来很中二，我今天依然相信，技术可以改变世界。在GDC和GoogleIO上发布Airtest，算是达成了一点小目标。可是做游戏，至少在网易，离梦想却是渐行渐远。</p>
<hr>
<p>本科时认真做的两件事，考GRE和打Dota。以前我是个狂热的游戏玩家，打游戏就是要赢。为了Dota毕业杯，能拉十个人去训练个把月，热血依旧。清晰地记得当时的心境，做游戏多有激情，为何要去美帝大农村？于是拒掉USC，来到网易。</p>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2019/06/07/netease-games/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </div>

    
      


    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://meteorix.github.io/2019/05/24/pyflame/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="meteorix">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/qiyu.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Meteorix's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/05/24/pyflame/" class="post-title-link" itemprop="url">Pyflame解析和扩展</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-05-24 20:12:22" itemprop="dateCreated datePublished" datetime="2019-05-24T20:12:22+08:00">2019-05-24</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-08-11 16:20:07" itemprop="dateModified" datetime="2019-08-11T16:20:07+08:00">2019-08-11</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p><a href="https://github.com/uber/pyflame" target="_blank" rel="noopener">Pyflame</a>是uber开源的一个python性能profiler。</p>
<blockquote>
<p>没有profile的优化就是耍流氓</p>
</blockquote>
<p>说起python，被吐槽最多的就是慢。根据上面的名言，首先我们需要一个性能profiler。</p>
<h1 id="profiler的两种原理"><a href="#profiler的两种原理" class="headerlink" title="profiler的两种原理"></a>profiler的两种原理</h1><p>profile工具基本分成两种思路：</p>
<ol>
<li><p>插桩</p>
<p> 这个理解起来非常直白，在每个函数的开始和结束时计时，然后统计每个函数的执行时间。python自带的<code>Profile</code>和<code>cProfile</code>模块就是这个原理。但是插桩会有两个问题，一是插桩计时本身带来的性能消耗<code>overhead</code>极大，二是对一个正在运行的程序没法插桩。</p>
</li>
<li><p>采样</p>
<p> 采样是注入正在运行的进程，高频地去探测函数调用栈。根据大数定理，探测到次数越多的函数运行时间越长。pyflame正是基于采样的原理。统计结果用另一个神器——火焰图<a href="http://www.brendangregg.com/flamegraphs.html" target="_blank" rel="noopener">flamegraph</a>展示，我们就可以完整地了解cpu运行状态。</p>
</li>
</ol>
<h1 id="使用pyflame和火焰图"><a href="#使用pyflame和火焰图" class="headerlink" title="使用pyflame和火焰图"></a>使用pyflame和火焰图</h1><p>官方提供了pyflame源码，需要自己编译对应python版本，然后调用flamegraph生成火焰图svg。具体可以看<a href="https://pyflame.readthedocs.io/en/latest/" target="_blank" rel="noopener">官方文档</a>。为了方便自己人使用，我写了个pyflame-server。</p>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2019/05/24/pyflame/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </div>

    
      


    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://meteorix.github.io/2019/04/30/pytorch-coredump/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="meteorix">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/qiyu.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Meteorix's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/04/30/pytorch-coredump/" class="post-title-link" itemprop="url">记一次pytorch的coredump调试</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-04-30 19:47:32" itemprop="dateCreated datePublished" datetime="2019-04-30T19:47:32+08:00">2019-04-30</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-08-11 16:20:07" itemprop="dateModified" datetime="2019-08-11T16:20:07+08:00">2019-08-11</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <ol>
<li><p>两个算法小哥写了个flask的web服务器，跑ocr的服务。单个请求是好的，多请求就崩了, log就显示：<br> <code>Segmentation fault (core dumped)</code></p>
<blockquote>
<p>  “wtf is core dump?”</p>
</blockquote>
<p> just google it, 简单说就是程序崩溃之后dump出来的一些信息</p>
</li>
<li><p>调试到了凌晨2点，加了一堆log，还是没有找到原因，看起来很随机。第二天找到我：</p>
<blockquote>
<p>python coredump了怎么办？</p>
</blockquote>
</li>
<li><p>为了debug这个coredump，先打开系统设置</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ulimit -c unlimited</span><br></pre></td></tr></table></figure>
</li>
<li><p>再次制造coredump，在当前目录下就产生了一个4G的core文件</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-rw------- 1 liuxin root 4.2G 4月  29 14:21 core</span><br></pre></td></tr></table></figure>
</li>
<li><p>core文件就是保存了crash时候的所有信息，调用栈、线程、内存等。然后运用我们的linux c++开发经验，可以知道用gdb来调试coredump文件</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gdb &lt;executable&gt; &lt;coredump file&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>等等，这里我们是python程序崩了，为什么没有traceback？因为在调用到pytorch的c++代码时，直接segmentfault，并没能等到python的退出机制打印出traceback，直接崩了。但是操作系统能产生coredump文件，这是我们的救命稻草。</p>
</li>
</ol>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2019/04/30/pytorch-coredump/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </div>

    
      


    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://meteorix.github.io/2019/02/13/vsdebugpycpp/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="meteorix">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/qiyu.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Meteorix's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/13/vsdebugpycpp/" class="post-title-link" itemprop="url">vs2017混合调试py/c++</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-13 23:51:32" itemprop="dateCreated datePublished" datetime="2019-02-13T23:51:32+08:00">2019-02-13</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-04-22 23:46:24" itemprop="dateModified" datetime="2019-04-22T23:46:24+08:00">2019-04-22</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="vs2017混合调试py-c"><a href="#vs2017混合调试py-c" class="headerlink" title="vs2017混合调试py/c++"></a>vs2017混合调试py/c++</h1><h2 id="python卡死了怎么办"><a href="#python卡死了怎么办" class="headerlink" title="python卡死了怎么办?"></a>python卡死了怎么办?</h2><p>一般的python程序卡死，可以用pycharm debug。但是有时候是python和c/c++库混合开发，比如pyqt或者boost python程序卡死，就非常难查。以前都是二分法注释代码查找问题，异常低效。</p>
<p>于是我尝试了vs2017的新功能：python &amp; c++ 混合调试 <a href="https://docs.microsoft.com/en-us/visualstudio/python/debugging-mixed-mode-c-cpp-python-in-visual-studio?view=vs-2017" target="_blank" rel="noopener">Debug Python and C++ together</a></p>
<h2 id="vs2017-python"><a href="#vs2017-python" class="headerlink" title="vs2017 python"></a>vs2017 python</h2><p>vs一直被称为宇宙最强IDE，貌似python支持是vs2017新加的功能。相比pycharm之类的python编辑器，vs2017最大的优势就是在python和native c/c++代码的混合调试。包括：</p>
<ul>
<li>python / c++ 调用栈合并显示</li>
<li>python / c++ 都可以断点</li>
<li>python / c++ 代码之间step</li>
<li>python / c++ 对象都可以watch</li>
</ul>
<p>由于python的性能瓶颈，很多时候混合开发需要同时调试，这正是我们需要的！</p>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2019/02/13/vsdebugpycpp/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </div>

    
      


    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://meteorix.github.io/2019/02/13/gdbpython/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="meteorix">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/qiyu.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Meteorix's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/13/gdbpython/" class="post-title-link" itemprop="url">gdb调试cpython</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-13 23:11:32" itemprop="dateCreated datePublished" datetime="2019-02-13T23:11:32+08:00">2019-02-13</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-04-22 23:46:37" itemprop="dateModified" datetime="2019-04-22T23:46:37+08:00">2019-04-22</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="gdb调试cpython"><a href="#gdb调试cpython" class="headerlink" title="gdb调试cpython"></a>gdb调试cpython</h1><p>主要参考这篇文章：</p>
<ul>
<li><a href="https://www.podoliaka.org/2016/04/10/debugging-cpython-gdb/" target="_blank" rel="noopener">https://www.podoliaka.org/2016/04/10/debugging-cpython-gdb/</a></li>
<li><a href="https://blog.alswl.com/2013/11/python-gdb/" target="_blank" rel="noopener">https://blog.alswl.com/2013/11/python-gdb/</a></li>
</ul>
<h2 id="同时debug-c栈和py栈"><a href="#同时debug-c栈和py栈" class="headerlink" title="同时debug c栈和py栈"></a>同时debug c栈和py栈</h2><p>在调试脚本卡死的时候特别有用，如下图</p>
<p><img src="/images/gdbpython/bt.png" alt="image"></p>
<h2 id="安装python-dbg"><a href="#安装python-dbg" class="headerlink" title="安装python-dbg"></a>安装python-dbg</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install gdb python-dbg</span><br></pre></td></tr></table></figure>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2019/02/13/gdbpython/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </div>

    
      


    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://meteorix.github.io/2019/02/13/newubuntu/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="meteorix">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/qiyu.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Meteorix's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/13/newubuntu/" class="post-title-link" itemprop="url">新ubuntu环境搭建</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-13 22:41:32" itemprop="dateCreated datePublished" datetime="2019-02-13T22:41:32+08:00">2019-02-13</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-08-11 16:20:07" itemprop="dateModified" datetime="2019-08-11T16:20:07+08:00">2019-08-11</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="新ubuntu环境搭建"><a href="#新ubuntu环境搭建" class="headerlink" title="新ubuntu环境搭建"></a>新ubuntu环境搭建</h1><h3 id="apt"><a href="#apt" class="headerlink" title="apt"></a>apt</h3><p>替换apt源</p>
<ul>
<li>源列表：<a href="http://wiki.ubuntu.org.cn/" target="_blank" rel="noopener">http://wiki.ubuntu.org.cn/</a></li>
<li>清华源：<a href="https://mirror.tuna.tsinghua.edu.cn/help/ubuntu/" target="_blank" rel="noopener">https://mirror.tuna.tsinghua.edu.cn/help/ubuntu/</a></li>
</ul>
<p>安装<code>zsh/vim/git</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install zsh vim git</span><br></pre></td></tr></table></figure>
<h3 id="git"><a href="#git" class="headerlink" title="git"></a>git</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global core.editor &quot;vim&quot;</span><br><span class="line">git config --global --edit  # 设置name和email</span><br></pre></td></tr></table></figure>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2019/02/13/newubuntu/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </div>

    
      


    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://meteorix.github.io/2019/02/05/airtest-douyin/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="meteorix">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/qiyu.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Meteorix's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/05/airtest-douyin/" class="post-title-link" itemprop="url">Airtest刷刷抖音</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-05 22:41:32" itemprop="dateCreated datePublished" datetime="2019-02-05T22:41:32+08:00">2019-02-05</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-04-22 23:48:15" itemprop="dateModified" datetime="2019-04-22T23:48:15+08:00">2019-04-22</time>
              
            
          </span>

          

          
            
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="Airtest刷刷抖音"><a href="#Airtest刷刷抖音" class="headerlink" title="Airtest刷刷抖音"></a>Airtest刷刷抖音</h1><p>用<a href="https://github.com/AirtestProject/Airtest" target="_blank" rel="noopener">Airtest</a>做点有意思的事情，先来刷个抖音？</p>
<p><a href="https://github.com/Meteorix/airtest-douyin" target="_blank" rel="noopener">github仓库 airtest-douyin</a></p>
<p><img src="/images/airtest-douyin/ide01.png" alt="ide01"></p>
<h2 id="Get-Started"><a href="#Get-Started" class="headerlink" title="Get Started"></a>Get Started</h2><h3 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h3><p>手边没有android手机，iOS又懒得搭<a href="https://github.com/AirtestProject/iOS-Tagent" target="_blank" rel="noopener">ios-tagent</a>的环境，于是采用最偷懒的方式：</p>
<ul>
<li><a href="https://www.yeshen.com/" target="_blank" rel="noopener">夜神模拟器</a>（可用安卓机代替）</li>
<li><a href="http://airtest.netease.com/" target="_blank" rel="noopener">AirtestIDE</a></li>
</ul>
          <!--noindex-->
          
            <div class="post-button text-center">
              <a class="btn" href="/2019/02/05/airtest-douyin/#more" rel="contents">
                Read more &raquo;
              </a>
            </div>
          
          <!--/noindex-->
        
      
    </div>

    
      


    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/qiyu.jpg" alt="meteorix">
            
              <p class="site-author-name" itemprop="name">meteorix</p>
              <div class="site-description motion-element" itemprop="description"></div>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">12</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                      <a href="/tags/">
                    
                  
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">8</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://github.com/meteorix" title="GitHub &rarr; https://github.com/meteorix" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
            </div>
          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">meteorix</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a> v7.1.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/utils.js?v=7.1.0"></script>

  <script src="/js/motion.js?v=7.1.0"></script>



  
  


  <script src="/js/affix.js?v=7.1.0"></script>

  <script src="/js/schemes/pisces.js?v=7.1.0"></script>



  

  


  <script src="/js/next-boot.js?v=7.1.0"></script>


  

  

  

  



  




  

  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
